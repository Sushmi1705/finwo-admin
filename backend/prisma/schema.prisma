generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id               String          @id @default(uuid())
  name             String?
  email            String?         @unique
  mobile           String          @unique
  password         String?
  otpCode          String?         @map("otp_code")
  securityPin      String?         @map("security_pin")
  profileImageUrl  String?         @map("profile_image_url")
  isAdmin          Boolean         @default(false) @map("is_admin")
  status           UserStatus      @default(ACTIVE)
  createdAt        DateTime        @default(now()) @map("created_at")
  lastLogin        DateTime?       @map("last_login")
  phoneAuthEnabled Boolean         @default(false)
  upiId            String?         @map("upi_id")
  securityPinHash  String?         @map("security_pin_hash")
  securityPinSet   Boolean         @default(false) @map("security_pin_set")
  fcmToken         String?
  searchHistory    SearchHistory[]
  addresses        Address[]
  payments         Payment[]
  reports          Report?
  reviewReplies    ReviewReply[]
  reviews          Review[]
  savedShops       SavedShop[]
  settings         Setting?
  transactions     Transaction[]

  @@map("users")
}

model SearchHistory {
  id         String   @id @default(uuid())
  userId     String
  query      String
  searchedAt DateTime @default(now())
  targetId   String?
  targetName String?
  targetType String?
  latitude   Float?
  longitude  Float?
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([searchedAt])
}

model Address {
  id                   String   @id @default(uuid())
  userId               String   @map("user_id")
  label                String
  customLabel          String?  @map("custom_label")
  addressLine1         String   @map("address_line1")
  addressLine2         String?  @map("address_line2")
  landmark             String?
  city                 String
  state                String?
  pincode              String?
  country              String   @default("India")
  latitude             Float
  longitude            Float
  isDefault            Boolean  @default(false) @map("is_default")
  deliveryInstructions String?  @map("delivery_instructions")
  createdAt            DateTime @default(now()) @map("created_at")
  updatedAt            DateTime @updatedAt @map("updated_at")
  user                 User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("addresses")
}

model SuggestionSection {
  id             String           @id @default(uuid())
  title          String
  subtitle       String?
  imageUrl       String?          @map("image_url")
  type           SuggestionType
  mainCategoryId String?          @map("main_category_id")
  config         Json?
  sortOrder      Int              @default(0) @map("sort_order")
  isActive       Boolean          @default(true) @map("is_active")
  createdAt      DateTime         @default(now()) @map("created_at")
  items          SuggestionItem[]
  mainCategory   MainCategory?    @relation(fields: [mainCategoryId], references: [id])

  @@index([type])
  @@index([isActive, sortOrder])
  @@map("suggestion_sections")
}

model SuggestionItem {
  id             String            @id @default(uuid())
  sectionId      String            @map("section_id")
  title          String
  subtitle       String?
  imageUrl       String?           @map("image_url")
  shopId         String?           @map("shop_id")
  mainCategoryId String?           @map("main_category_id")
  sortOrder      Int               @default(0) @map("sort_order")
  isActive       Boolean           @default(true) @map("is_active")
  createdAt      DateTime          @default(now()) @map("created_at")
  mainCategory   MainCategory?     @relation(fields: [mainCategoryId], references: [id])
  shop           Shop?             @relation(fields: [shopId], references: [id])
  section        SuggestionSection @relation(fields: [sectionId], references: [id], onDelete: Cascade)

  @@index([sectionId])
  @@map("suggestion_items")
}

model QuickSnackCategory {
  id        String   @id @default(uuid())
  name      String   @unique
  iconUrl   String?
  sortOrder Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model MainCategory {
  id                 String              @id @default(uuid())
  name               String              @map("category_name")
  imageUrl           String?             @map("image_url")
  isActive           Boolean             @default(true) @map("is_active")
  createdAt          DateTime            @default(now()) @map("created_at")
  appUiConfigs       AppUiConfig[]
  banners            CategoryBanner[]
  shops              Shop[]
  suggestionItems    SuggestionItem[]
  suggestionSections SuggestionSection[]

  @@map("main_categories")
}

model Shop {
  id                String           @id @default(uuid())
  categoryId        String           @map("category_id")
  name              String
  logoUrl           String?          @map("logo_url")
  description       String?
  reviewDescription String?          @map("review_description")
  address           String?
  city              String?
  latitude          Float?
  longitude         Float?
  phoneNumber       String?          @map("phone_number")
  websiteUrl        String?          @map("website_url")
  chatLink          String?          @map("chat_link")
  openHours         String?          @map("open_hours")
  avgRating         Float?           @default(0)
  reviewCount       Int              @default(0) @map("review_count")
  createdAt         DateTime         @default(now()) @map("created_at")
  isActive          Boolean          @default(true)
  area              String?
  compareItems      CompareItem[]
  menus             Menu[]
  payments          Payment[]
  qrCodes           QRCode[]
  reviews           Review[]
  savedBy           SavedShop[]
  amenities         ShopAmenity[]
  images            ShopImage[]
  offers            ShopOffer[]
  category          MainCategory     @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  suggestionItems   SuggestionItem[]

  @@index([city])
  @@index([area])
  @@map("shops")
}

model ShopImage {
  id        String  @id @default(uuid())
  shopId    String  @map("shop_id")
  imageUrl  String  @map("image_url")
  isPrimary Boolean @default(false) @map("is_primary")
  shop      Shop    @relation(fields: [shopId], references: [id], onDelete: Cascade)

  @@map("shop_images")
}

model ShopOffer {
  id          String    @id @default(uuid())
  shopId      String    @map("shop_id")
  title       String
  description String?
  validFrom   DateTime? @map("valid_from")
  validTo     DateTime? @map("valid_to")
  terms       String?
  isActive    Boolean   @default(true) @map("is_active")
  shop        Shop      @relation(fields: [shopId], references: [id], onDelete: Cascade)

  @@map("shop_offers")
}

model ShopAmenity {
  id          String  @id @default(uuid())
  shopId      String  @map("shop_id")
  name        String
  icon        String?
  isAvailable Boolean @default(true) @map("is_available")
  shop        Shop    @relation(fields: [shopId], references: [id], onDelete: Cascade)

  @@map("shop_amenities")
}

model Menu {
  id           String  @id @default(uuid())
  shopId       String  @map("shop_id")
  itemName     String  @map("item_name")
  description  String?
  price        Float
  quantity     Int?
  imageUrl     String? @map("image_url")
  categoryName String? @map("category_name")
  isAvailable  Boolean @default(true) @map("is_available")
  isQuickSnack Boolean @default(false)
  shop         Shop    @relation(fields: [shopId], references: [id], onDelete: Cascade)

  @@map("menus")
}

model AppConfig {
  id    String @id @default(uuid())
  key   String @unique
  value String

  @@map("app_config")
}

model ReviewTag {
  id          String          @id @default(uuid())
  tagName     String          @unique @map("tag_name")
  description String?
  reviewLinks ReviewTagLink[]

  @@map("review_tags")
}

model Review {
  id         String          @id @default(uuid())
  shopId     String          @map("shop_id")
  userId     String?         @map("user_id")
  rating     Int
  comment    String?
  isApproved Boolean         @default(true)
  anonymous  Boolean         @default(false)
  paymentId  String?         @map("payment_id")
  createdAt  DateTime        @default(now()) @map("created_at")
  media      ReviewMedia[]
  replies    ReviewReply[]
  tags       ReviewTagLink[]
  payment    Payment?        @relation("PaymentReviews", fields: [paymentId], references: [id])
  user       User?           @relation(fields: [userId], references: [id], onDelete: Cascade)
  shop       Shop            @relation(fields: [shopId], references: [id], onDelete: Cascade)

  @@index([shopId, createdAt])
  @@index([userId, createdAt])
  @@map("reviews")
}

model ReviewTagLink {
  id       String    @id @default(uuid())
  reviewId String    @map("review_id")
  tagId    String    @map("tag_id")
  tag      ReviewTag @relation(fields: [tagId], references: [id], onDelete: Cascade)
  review   Review    @relation(fields: [reviewId], references: [id], onDelete: Cascade)

  @@unique([reviewId, tagId])
  @@map("review_tag_links")
}

model ReviewReply {
  id        String   @id @default(uuid())
  reviewId  String   @map("review_id")
  adminId   String   @map("admin_id")
  message   String
  createdAt DateTime @default(now()) @map("created_at")
  admin     User     @relation(fields: [adminId], references: [id], onDelete: Cascade)
  review    Review   @relation(fields: [reviewId], references: [id], onDelete: Cascade)

  @@map("review_replies")
}

model ReviewMedia {
  id        String   @id @default(uuid())
  reviewId  String   @map("review_id")
  url       String
  mimeType  String
  kind      String
  createdAt DateTime @default(now()) @map("created_at")
  review    Review   @relation(fields: [reviewId], references: [id], onDelete: Cascade)

  @@map("review_media")
}

model SavedShop {
  id      String   @id @default(uuid())
  userId  String   @map("user_id")
  shopId  String   @map("shop_id")
  savedAt DateTime @default(now()) @map("saved_at")
  shop    Shop     @relation(fields: [shopId], references: [id], onDelete: Cascade)
  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, shopId])
  @@map("saved_shops")
}

model Transaction {
  id          String            @id @default(uuid())
  userId      String            @map("user_id")
  txnType     TransactionType   @map("txn_type")
  source      TransactionSource
  amount      Float
  description String?
  status      TransactionStatus @default(PENDING)
  createdAt   DateTime          @default(now()) @map("created_at")
  user        User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("transactions")
}

model Payment {
  id         String        @id @default(uuid())
  userId     String        @map("user_id")
  shopId     String        @map("shop_id")
  menuId     String?       @map("menu_id")
  menuName   String?       @map("menu_name")
  amount     Float
  txnRef     String?       @map("txn_ref")
  status     PaymentStatus @default(SUCCESS)
  isReviewed Boolean       @default(false)
  createdAt  DateTime      @default(now()) @map("created_at")
  shop       Shop          @relation(fields: [shopId], references: [id], onDelete: Cascade)
  user       User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  reviews    Review[]      @relation("PaymentReviews")

  @@index([userId])
  @@index([shopId])
  @@index([isReviewed])
  @@map("payments")
}

model Report {
  id             String   @id @default(uuid())
  userId         String   @unique @map("user_id")
  totalEarned    Float    @default(0)
  totalSpent     Float    @default(0)
  monthlySummary Json?    @map("monthly_summary")
  lastUpdated    DateTime @default(now()) @updatedAt @map("last_updated")
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("reports")
}

model CategoryBanner {
  id             String       @id @default(uuid())
  mainCategoryId String       @map("main_category_id")
  imageUrl       String       @map("image_url")
  title          String?
  linkUrl        String?
  isActive       Boolean      @default(true) @map("is_active")
  createdAt      DateTime     @default(now()) @map("created_at")
  mainCategory   MainCategory @relation(fields: [mainCategoryId], references: [id], onDelete: Cascade)

  @@map("category_banners")
}

model QRCode {
  id          String   @id @default(uuid())
  linkedShop  String?  @map("linked_shop")
  qrType      QRType   @map("qr_type")
  data        String
  generatedAt DateTime @default(now()) @map("generated_at")
  shop        Shop?    @relation(fields: [linkedShop], references: [id])

  @@map("qr_codes")
}

model Setting {
  id                   String   @id @default(uuid())
  userId               String   @unique @map("user_id")
  notificationsEnabled Boolean  @default(true) @map("notifications_enabled")
  reviewNotifications  Boolean  @default(true) @map("review_notifications")
  paymentNotifications Boolean  @default(true) @map("payment_notifications")
  darkMode             Boolean  @default(false) @map("dark_mode")
  appLanguage          String   @default("en") @map("app_language")
  createdAt            DateTime @default(now()) @map("created_at")
  user                 User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("settings")
}

model AppUiConfig {
  id             String        @id @default(uuid())
  screenName     ScreenName    @map("screen_name")
  componentType  ComponentType @map("component_type")
  componentName  String        @map("component_name")
  behaviour      BehaviourType @default(STATIC)
  iconUrl        String?       @map("icon_url")
  imageUrl       String?       @map("image_url")
  location       String?
  mainCategoryId String?       @map("main_category_id")
  config         Json?
  isActive       Boolean       @default(true) @map("is_active")
  sortOrder      Int           @default(0) @map("sort_order")
  createdAt      DateTime      @default(now()) @map("created_at")
  updatedAt      DateTime      @updatedAt @map("updated_at")
  subtitle       String?
  mainCategory   MainCategory? @relation(fields: [mainCategoryId], references: [id])

  @@index([screenName, componentType, isActive])
  @@index([location])
  @@index([sortOrder])
  @@index([mainCategoryId])
  @@map("app_ui_config")
}

model CompareList {
  id        String        @id @default(uuid())
  userId    String?
  sessionId String?
  createdAt DateTime      @default(now())
  items     CompareItem[]
}

model CompareItem {
  id        String      @id @default(uuid())
  compareId String
  shopId    String
  addedAt   DateTime    @default(now())
  shop      Shop        @relation(fields: [shopId], references: [id], onDelete: Cascade)
  compare   CompareList @relation(fields: [compareId], references: [id], onDelete: Cascade)

  @@unique([compareId, shopId])
}

model ReviewGuideline {
  id        String   @id @default(uuid())
  key       String?  @unique @map("key")
  text      String   @map("text")
  locale    String   @default("en")
  isActive  Boolean  @default(true) @map("is_active")
  sortOrder Int      @default(0) @map("sort_order")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([locale, isActive, sortOrder])
  @@map("review_guidelines")
}

model Notification {
  id           String   @id @default(uuid())
  userId       String
  title        String
  body         String
  type         String
  amount       Float?
  meta         Json?
  isRead       Boolean  @default(false)
  isDeleted    Boolean  @default(false)
  isActionable Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([userId, createdAt])
}

enum UserStatus {
  ACTIVE
  BLOCKED
}

enum SuggestionType {
  NEAR_ME
  QUICK_SNACK
  CATEGORY_SHOPS
  CUSTOM
}

enum TransactionType {
  CREDIT
  DEBIT
}

enum TransactionSource {
  WALLET
  QR_SCAN
  PAYOUT
}

enum TransactionStatus {
  PENDING
  SUCCESS
  FAILED
}

enum PaymentStatus {
  PENDING
  SUCCESS
  FAILED
}

enum PaymentMethod {
  BANK
  UPI
  WALLET
}

enum PayoutStatus {
  PENDING
  PROCESSED
  FAILED
}

enum QRType {
  PAYMENT
  INFO
  REFERRAL
}

enum ScreenName {
  LANDING_PAGE
  SUGGESTIONS
  NEAR_ME
}

enum ComponentType {
  SECTION
  CHIP
  BANNER
}

enum BehaviourType {
  STATIC
  NEAR_ME
  QUICK_SNACK
  CATEGORY_BASED
  CUSTOM_QUERY
}


